<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>志願序最終結果</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
body { font-family: "Noto Sans TC", sans-serif; background-color: #f8f9fa; margin-top: 80px; }
.top-bar { position: fixed; top:0; left:0; width:100%; height:60px; background:#fff; z-index:1100; display:flex; align-items:center; justify-content:center; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.top-bar h1 { font-size:1.5rem; color:#0066cc; margin:0; }
.container { max-width:1200px; }
h2 { margin:30px 0 20px; color:#0066cc; font-weight:700; text-align:center; }
.student-section { background:#fff; margin-bottom:1.5rem; padding:1rem 1.5rem; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.06); }
.student-section h3 { color:#0066cc; font-weight:bold; margin-bottom:0.5rem; }
.student-section .class-label { font-weight:normal; color:#555; margin-bottom:1rem; }
table { width:100%; border-collapse:collapse; margin-bottom:10px; }
th, td { padding:0.75rem; border:1px solid #e0e0e0; text-align:center; }
th { background-color:#f1f4f8; }
.input-group { max-width:250px; margin-right:0.5rem; }
.btn-group button { margin-left:0.5rem; }
</style>
</head>
<body>
<div class="top-bar"><h1>學生最終志願序結果</h1></div>

<div class="container mt-4">
  <!-- 查詢與匯出 -->
  <div class="d-flex flex-wrap justify-content-center align-items-center mb-4 gap-2">
    <input type="text" id="searchStudentInput" class="form-control" placeholder="學生姓名">
    <input type="text" id="searchClassInput" class="form-control" placeholder="班級">
    <input type="text" id="searchCompanyInput" class="form-control" placeholder="公司名稱">
    <button id="searchBtn" class="btn btn-outline-secondary"><i class="fas fa-search"></i> 查詢</button>
    <button id="clearBtn" class="btn btn-warning"><i class="fas fa-eraser"></i> 清除查詢</button>
    <div class="btn-group" role="group">
      <button id="exportExcelBtn" class="btn btn-success"><i class="fas fa-file-excel"></i> Excel</button>
      <button id="exportWordBtn" class="btn btn-info"><i class="fas fa-file-word"></i> Word</button>
      <button id="exportPdfBtn" class="btn btn-danger"><i class="fas fa-file-pdf"></i> PDF</button>
    </div>
  </div>

  <!-- 學生資料區，動態生成 -->
  <div id="studentContainer">
    <!-- 學生資料將由後端或前端 JS 動態生成，此處不顯示範例 -->
  </div>
</div>

<script>
function filterStudents() {
  const nameTerm = document.getElementById('searchStudentInput').value.trim().toLowerCase();
  const classTerm = document.getElementById('searchClassInput').value.trim().toLowerCase();
  const companyTerm = document.getElementById('searchCompanyInput').value.trim().toLowerCase();

  const visibleStudents = [];
  document.querySelectorAll('.student-section').forEach(section => {
    const name = section.dataset.name.toLowerCase();
    const className = section.dataset.class.toLowerCase();
    const companyMatches = Array.from(section.querySelectorAll('table tbody tr td:nth-child(2)'))
      .some(td => td.textContent.toLowerCase().includes(companyTerm));

    const show = (!nameTerm || name.includes(nameTerm)) &&
                 (!classTerm || className.includes(classTerm)) &&
                 (!companyTerm || companyMatches);

    section.style.display = show ? 'block' : 'none';
    if(show) visibleStudents.push(section);
  });
  return visibleStudents;
}

document.getElementById('searchBtn').addEventListener('click', filterStudents);
document.getElementById('clearBtn').addEventListener('click', () => {
  document.getElementById('searchStudentInput').value='';
  document.getElementById('searchClassInput').value='';
  document.getElementById('searchCompanyInput').value='';
  document.querySelectorAll('.student-section').forEach(section => section.style.display='block');
});

document.getElementById('exportExcelBtn').addEventListener('click', () => {
  const visibleStudents = filterStudents();
  let csvContent = "學生姓名,班級,志願序,公司名稱,送出時間\n";
  visibleStudents.forEach(section => {
    const studentName = section.dataset.name;
    const className = section.dataset.class;
    section.querySelectorAll('table tbody tr').forEach(tr => {
      const order = tr.children[0].textContent;
      const company = tr.children[1].textContent;
      const time = tr.children[2].textContent;
      csvContent += `${studentName},${className},${order},${company},${time}\n`;
    });
  });
  const blob = new Blob([csvContent], { type:'text/csv;charset=utf-8;' });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "學生志願序.csv";
  link.click();
});

function exportTextFile(filename, content) {
  const blob = new Blob([content], { type: 'text/plain;charset=utf-8;' });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = filename;
  link.click();
}

document.getElementById('exportWordBtn').addEventListener('click', () => {
  const visibleStudents = filterStudents();
  let content = '';
  visibleStudents.forEach(section => {
    content += `學生: ${section.dataset.name}\n班級: ${section.dataset.class}\n`;
    section.querySelectorAll('table tbody tr').forEach(tr => {
      content += `志願序:${tr.children[0].textContent}, 公司:${tr.children[1].textContent}, 送出時間:${tr.children[2].textContent}\n`;
    });
    content += '\n';
  });
  exportTextFile('學生志願序.docx', content);
});

document.getElementById('exportPdfBtn').addEventListener('click', () => {
  const visibleStudents = filterStudents();
  let content = '';
  visibleStudents.forEach(section => {
    content += `學生: ${section.dataset.name}\n班級: ${section.dataset.class}\n`;
    section.querySelectorAll('table tbody tr').forEach(tr => {
      content += `志願序:${tr.children[0].textContent}, 公司:${tr.children[1].textContent}, 送出時間:${tr.children[2].textContent}\n`;
    });
    content += '\n';
  });
  exportTextFile('學生志願序.pdf', content);
});
</script>
</body>
</html>